2020-08-09



# Item15. 클래스와 멤버의 접근 권한을 최소화하라

어설프게 설계된 컴포넌트와 잘 설계된 컴포넌트의 가장 큰 차이는 바로 클래스 내부 데이터와 내부 구현 정보를 외부 컴포넌트로부터 얼마나 잘 숨겼느냐다. 

오직 API를 통해서만 다른 컴포넌트와 소통하며 서로의 내부 동작 방식에 전혀 개의치 않는다. 

**정보 은닉, 혹은 캡슐화라고 하는 이 개념은 소프트웨어 설계의 근간이 되는 원리다.** 

## 정보 은닉의 장점

1. 시스템 개발 속도를 높인다. 
2. 시스템 관리 비용을 낮춘다. 
3. 정보 은닉 자체가 성능을 높여주지는 않지만, 성능 최적화에 도움을 준다. 
완성된 시스템을 프로파일링해 최적화할 컴포넌트를 정한 다음(아이템67) 다른 컴포넌트에 영향을 주지 않고 해당 컴포넌트만 최적화 할 수 있기 때문이다. 
4. 소프트웨어 재사용성을 높인다. 
5. 큰 시스템을 제작하는 난이도를 낮춰 준다.

자바는 정보 은닉을 위한 다양한 장치를 제공한다. 그 중 접근 제어 메커니즘은 클래스, 인터페이스, 접근 허용 범위를 명시한다. 

 

## 정보 은닉의 기본 원칙

### **모든 클래스와 멤버의 접근성을 가능한 한 좁혀야 한다.**

다시 말해, 소프트웨어가 올바로 동작하는 한 항상 가장 낮은 접근 수준을 부여해야 한다. 

1. 탑 레벨 클래스 or 인터페이스 
    - 탑 레벨 클래스나 인터페이스를 패키지 외부에서 쓸 이유가 없다면 package-private으로 설정하자.
    - public으로 선언하면 API가 되므로 하위 호환을 위해 영원히 관리해줘야 한다.
    - package-private는 이를 사용하는 클래스 안에 private static으로 중첩시킨다.(아이템24)

2. 멤버(필드, 메서드, 중첩 클래스, 중첩 인터페이스)
    - 클래스의 공개 API를 세심히 설계한 후, 그 외의 모든 멤버는 private으로 만들자.
    - 오직 같은 패키지의 다른 클래스가 접근해야 하는 멤버에 한하여 package-private으로 풀어준다.
    - protected로 설정하는 순간 멤버의 접근 할 수 있는 대상의 범위가 매우 넓어지므로 적을수록 좋다.

3. 상위 클래스에서 메서드를 재정의할 때는그 접근 수준을 상위 클래스에서보다 좁게 설정할 수 없다. 
4. 테스트만을 위해 클래스, 인터페이스, 멤버를 공개 API로 만들어서는 안된다. 

### public 클래스의 인스턴스 필드는 되도록 public이 아니어야 한다.(아이템16)

public 가변 필드를 갖는 클래스는 일반적으로 thread-safe 하지 않다. 

### 해당 클래스가 표현하는 추상 개념을 완성하는 데 꼭 필요한 구성요소로써의 상수라면 public static final필드로 공개해도 좋다.

관례상 이런 상수의 이름은 대문자 알파벳으로 쓰며, 각 단어 사이에 밑줄(_)을 넣는다(아이템 68)

이런 필드는 반드시 불변객체나 기본 타입 값을 참조해야 한다(아이템17)

### 클래스에서 public static final 배열 필드를 두거나 이 필드를 반환하는 접근자 메서드를
제공해서는 안된다.

 이런 필드나 접근자를 제공한다면 클라이언트가 배열의 내용을 수정할 수 있다.

```java
//보안의 허점이 존재한다.
public static final Thing[] VALUES = {...};
```

이걸 막기 위해서는 두가지 방법이 존재한다.

1. public 배열을 private으로 만들고 public 불변리스트를 추가한다. 
2. 배열을 private으로 만들고 그 복사본을 반환하는 public 메서드를 추가한다.

```java

private static final Thing[] PRIVATE_VALUES = {...};

//1번 방법
public static final List<Thing> VALUES = 
	Collections.unmodifiableList(Arrays.asList(PRIVATE_VALUES));

//2번 방법
public static final Thing[] values() {
	return PRIVATE_VALUES.clone();
}
```

자바9에서는 모듈 시스템이라는 개념이 도입 되면서 두 가지 암묵적 접근 수준이 추가되었다.

패키지가 클래스의 묶음이듯, 모듈은 패키지들의 묶음이다. 

모듈은 자신에 속하는 패키지 중 공개(export)할 것들을(관례상 [module-info.java](http://module-info.java) 파일에) 선언한다. 

protected 혹은 public 멤버라도 해당 패키지를 공개하지 않았다면 사용할 수 없다. 

그러나 같은 모듈을 이루는 패키지 내부에서는 자유롭게 사용할 수 있다. 

그러나 모듈 개념은 꼭 필요한 경우가 아니라면 당분간 사용하지 않는 것이 좋다.