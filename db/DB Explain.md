# DB 실행 계획

## Why Optimizer?

- DB에서 데이터를 조회하고 저장하는 작업이 거의 대다수 
서버의 70프로 이상이 SQL 처리시간

## Optimizer란

Optimizer는 인덱스의 유무, 데이터 분산 또는 편향 정도 등의 통계정보를 참고하여 여러 실행계획을 작성하고
이들의 비용을 연산하고, 가장 낮은 비용을 가진 실행계획을 선택하는 DBMS의 핵심 엔진

Optimizer는 한정된 통계로 인해 최적화를 못할 수 있다. 

→ 이때 실행계획을 바꿔야한다.

## 실행 계획

SQL에서 요구한 사항을 처리하기 위한 절차와 방법 

1. 조인 순서
2. 조인 방법
3. 액세스 기법(Index, Full Scan)

동일한 SQL에 대해 결과를 내는 방법은 여러가지지만 각 비용은 서로 다름

실행계획을 보기 위해선 MySQL에선 explain+SQL 문을 사용

## 최적화 예제

### Full Table Scan이 더 유리한 경우

- 테이블의 크기가 작을 때
- 조건절이 없을 때
- 조건에 일치하는 레코드 수가 굉장히 많을 때

## 쿼리 처리 흐름

1. 사용자가 작성한 쿼리
2. 파서가 SQL을 파싱해서 이상한 statement가 있는지 확인한다. 
3. 이상이 없으면 DB가 이해할 수 있는 언어로 바꾸고 Optimizer에게 전달
4. Optimizer는 여러 실행계획을 생성하고 비용 평가를 통해 가장 낮은 비용의 실행계획을 선택한다.
5. 비용 평가는 카탈로그 매니저의 통계를 활용하여 진행한다.